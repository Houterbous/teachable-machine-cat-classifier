<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teachable Machine Cat Classifier</title>
    
    <!-- Import Google Fonts (for custom text styling) -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <!-- Optional custom styling -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1 class="title">Teachable Machine Cat Classifier</h1>

        <!-- Button to trigger file upload -->
        <input type="file" accept="image/*" onchange="handleFileUpload(event)" class="file-input">
    
        <div id="image-container"></div>
        <div id="label-container"></div>

        <!-- Import TensorFlow.js and Teachable Machine libraries -->
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
        
        <script>
            let model;
            async function loadModel() {
                const URL = "https://teachablemachine.withgoogle.com/models/Wj3dFXubB/";
                model = await tm.image.load(URL + "model.json", URL + "metadata.json");
                console.log("Модель загружена!");
            }
            loadModel();

            function handleFileUpload(event) {
                let file = event.target.files[0];
                if (file) {
                    let reader = new FileReader();
                    reader.onload = function(e) {
                        let img = document.createElement("img");
                        img.src = e.target.result;
                        img.classList.add("uploaded-image");
                        document.getElementById("image-container").innerHTML = "";
                        document.getElementById("image-container").appendChild(img);
                        classifyImage(img);
                    };
                    reader.readAsDataURL(file);
                }
            }

            async function classifyImage(image) {
                if (!model) {
                    document.getElementById("label-container").innerText = "Модель еще загружается...";
                    return;
                }
                const prediction = await model.predict(image);
                let topPrediction = prediction.sort((a, b) => b.probability - a.probability)[0];
                document.getElementById("label-container").innerText = `Результат: ${topPrediction.className} (${(topPrediction.probability * 100).toFixed(2)}%)`;
            }
        </script>
    </div>
</body>
</html>
